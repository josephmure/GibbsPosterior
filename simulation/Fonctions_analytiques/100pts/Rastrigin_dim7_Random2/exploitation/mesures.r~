library(pscl)
library(GenSA)

#TYPE_NOYAU_MATERN <- "geometrique" #scan("type_noyau.txt", what="character")

dossier_courant <- getwd()
setwd("../../../..")
source("Briques_these.r")
source("MaxVraisemblanceIntegree.r")
source("densKernel.r")
setwd(dossier_courant)

NOMBRE_DIMENSIONS <- scan("../nombre_dimensions.txt")
REGULARITE <- read.table("../regularite_vraie.txt",as.is=TRUE)$V1
MATRICE_DISTANCES <- NULL
MATRICE_DISTANCES_FISHER <- NULL
MATRICE_ECART_PREDICTION_MOYENNE_CONDITIONNELLE_JUSTE <- NULL
MATRICE_ERREURS_PREDICTION <- NULL

TEMPS_RECUIT <- 10

#if(TYPE_NOYAU_MATERN == "geometrique")
#{
#	Posterior<-as.matrix(read.table("Posterior_anis_geom.txt", as.is=TRUE))
#}

#if (TYPE_NOYAU_MATERN == "tensorise")
#{
#	Posterior<-as.matrix(read.table("Posterior_tens.txt", as.is=TRUE))
#}


VECTEUR_GERMES_ALEATOIRES <- scan("../germes_aleatoires.txt")

LISTE_MLE <- as.matrix(read.table("../MLE.txt", as.is=TRUE))
LISTE_MAP <- as.matrix(read.table("../MAP.txt", as.is=TRUE))

for(numero_germe_aleatoire in 1:length(VECTEUR_GERMES_ALEATOIRES))
{
    
    germe_aleatoire <- VECTEUR_GERMES_ALEATOIRES[numero_germe_aleatoire]
    source("../../generePlanXP.r")
    source("../../genereObservations.r")
    
    argmax_vraisemblance_integree <- LISTE_MLE[numero_germe_aleatoire,]
    mode_posterior <- LISTE_MAP[numero_germe_aleatoire,]
    write.matrix(argmax_vraisemblance_integree ,"argmax_vraisemblance_integree.txt",sep = "\t")
    write.matrix(mode_posterior, "mode_posterior.txt",sep = "\t")

    source("../../compareResultats.r")

	MATRICE_DISTANCES <- rbind(MATRICE_DISTANCES, c( Distance_argmax_vraisemblance[1], Distance_mode_posterior[1]) )
	write.matrix(MATRICE_DISTANCES,"matrice_distances.txt",sep = "\t")

	MATRICE_DISTANCES_FISHER <- rbind(MATRICE_DISTANCES_FISHER, c( Distance_argmax_vraisemblance[2], Distance_mode_posterior[2]) )
	write.matrix(MATRICE_DISTANCES_FISHER,"matrice_distances_fisher.txt",sep = "\t")

	MATRICE_ECART_PREDICTION_MOYENNE_CONDITIONNELLE_JUSTE <- rbind ( MATRICE_ECART_PREDICTION_MOYENNE_CONDITIONNELLE_JUSTE, c( Ecart_prediction_argmax_vraisemblance_moyenne_conditionnelle_juste , Ecart_prediction_mode_posterior_moyenne_conditionnelle_juste) )
	write.matrix(MATRICE_ECART_PREDICTION_MOYENNE_CONDITIONNELLE_JUSTE,"matrice_ecarts_predictions_moyenne_cond_juste.txt",sep = "\t")

	MATRICE_ERREURS_PREDICTION <- rbind(MATRICE_ERREURS_PREDICTION, c(Ecart_prediction_argmax_vraisemblance, Ecart_prediction_mode_posterior) )
	write.matrix(MATRICE_ERREURS_PREDICTION,"matrice_ecarts_predictions.txt",sep = "\t")

}
